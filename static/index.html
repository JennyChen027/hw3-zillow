<!DOCTYPE html>
<html>
<head>
    <title>Zillow Pittsburgh</title>
    <!--Mika pick font :D-->

    <!-- Data Visualization library -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- topojason graphs -->
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <style>
        body {
          background-color: black;
          color: white;
          font-family: Arial, sans-serif;
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        h1 {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
        }

        .gridlines line {
          stroke: #bbb;
        }
      
        .gridlines .domain {
          stroke: none;
        }
        
        .border {
          stroke: #333;
          fill: none;
        }
        .neighborhood {
          fill: lightgrey;
          stroke: white;
          stroke-width: 1px;
        }

        .tooltip {
          position: absolute;
          background: white;
          padding: 5px;
          border: 1px solid black;
          border-radius: 5px;
          font-size: 12px;
          display: none;
          pointer-events: none;
        }

        /* Container for Filters + Views */
        .filter-container {
            width: 80%;
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
            border-bottom: 1px solid white;
        }

        /* Home List + Map Container */
        .main-container {
            display: flex;
            width: 80%;
            margin-top: 20px;
        }

        /* Home List */
        #list-container {
            width: 50%;
            height: 500px;
            overflow-y: auto;
            background: #222;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .list-item {
            width: 50px;
            height: 50px;
        }

        .list-item img {
            width: 100%;
            height: auto;
        }

        /* Map */
        #map-container {
            width: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #choropleth {
            background: rgb(255, 255, 255);
        }
    </style>
</head>
<body>
    <h1>
        Houses in Pittsburgh
    </h1>
    <div class="filter-container">
      <div>
        <label>Beds:</label>
        <select id="bedFilter">
            <option value="">Any</option>
            <option value="1">1+</option>
            <option value="2">2+</option>
            <option value="3">3+</option>
            <option value="4">4+</option>
        </select>
    </div>

    <div>
        <label>Baths:</label>
        <select id="bathFilter">
            <option value="">Any</option>
            <option value="1">1+</option>
            <option value="2">2+</option>
            <option value="3">3+</option>
            <option value="4">4+</option>
        </select>
    </div>

      <div>
        <label>Home Type:</label>
        <select id="homeTypeFilter">
            <option value="">Any</option>
            <option value="SingleFamily">Single Family</option>
            <option value="MultiFamily2To4">Multi-Family (2-4)</option>
            <option value="Townhouse">Townhouse</option>
            <option value="Condominium">Condo</option>
        </select>
    </div>

    </div>
    <svg id="choropleth" height="700" width="700" style="background: rgb(255, 255, 255); margin-top:0px"></svg>
    <div id="tooltip" class="tooltip"></div>

    <div id="list-container"></div>

    <script>

        const homeTypeIcons = {
          "SingleFamily": "images/singlefam.svg",
          "MultiFamily2To4": "images/multifam.svg",
          "Townhouse": "images/townhouse.svg",
          "Condominium": "images/condo.svg"
        };

        const homeTypeColors = d3.scaleOrdinal()
          .domain(["SingleFamily", "MultiFamily2To4", "Townhouse", "Condominium"])
          .range(["#4EC58C", "#3197CD", "#F5CA7D", "#F8957B"]); // Customize colors

        const choropleth = d3.select("#choropleth");
        const mapWidth = choropleth.attr("width");
        const mapHeight = choropleth.attr("height");
        const mapMargin = { top: 20, right: 20, bottom: 20, left: 20};
        const mapAreaWidth = mapWidth - mapMargin.left - mapMargin.right;
        const mapAreaHeight = mapHeight - mapMargin.top - mapMargin.bottom;
        const map = choropleth.append("g")
                    .attr("transform","translate("+mapMargin.left+","+mapMargin.top+")");

                    let houseData = []; // Global variable

        const loadData = async function() {
            houseData = (await d3.csv("zillow_pittsburgh.csv"))
                .filter(d => d.Neighborhood !== "Avalon")
                .filter(d => d.Neighborhood !== "Oakwood");

            // updateList(houseData);  // Initialize list with full dataset

            console.log("Data Loaded:", houseData.length, "homes");  // Debugging

            await loadMap(houseData); // Run loadMap only after data is ready
            loadHomes(houseData);

        };

        const applyFilters = () => {
          // jenny u can edit this with ur range slider stuff
          const minBeds = +document.getElementById("bedFilter").value || 0;
          const minBaths = +document.getElementById("bathFilter").value || 0;
          const homeType = document.getElementById("homeTypeFilter").value;


          // Apply filters
          let filteredData = houseData.filter(d => {
              return (
                  // +d.Price >= minPrice && +d.Price <= maxPrice &&
                  // +d.YearBuilt >= minYear && +d.YearBuilt <= maxYear &&
                  +d["Bedrooms"] >= minBeds &&
                  +d["Bathroom"] >= minBaths &&
                  (homeType === "" || d["Property Type"] === homeType)
              );
          });

          updateList(filteredData);
          updateMap(filteredData);
        };

        let pittsburghGeoJSON = null;

        const loadMap = async function() {
            if (houseData.length === 0) {
                return;
            }


            // check how many unique neighborhoods there are: 57
            const uniqueNeighborhoods = new Set(houseData.map(point => point.Neighborhood));

            pittsburghGeoJSON = await d3.json("pittsburgh.geojson");
            var neigh = pittsburghGeoJSON.features;

            var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], { type: "FeatureCollection", features: neigh });
            var path = d3.geoPath().projection(projection);
          
            map.selectAll("path.neighborhood").data(neigh)
                .join("path")
                .attr("class", "neighborhood")
                .attr("d", path);

            const tooltip = d3.select("#tooltip");

            map.selectAll("circle").data(houseData)
                .join("circle")
                .attr("class", "circle")
                .attr("cx", d => projection([+d.Longitude, +d.Latitude])[0])
                .attr("cy", d => projection([+d.Longitude, +d.Latitude])[1])
                .attr("r", 3)
                .attr("fill", d => homeTypeColors(d["Property Type"]) || "#ccc") 
                .attr("opacity", 0.7)
                .attr("stroke", "black")
                .attr("stroke-width", 0.5)
                .on("mouseover", (event, d) => {
                    tooltip.style("display", "block")
                          .html(`Neighborhood: <strong>${d.Neighborhood}</strong>`)
                          .style("left", (event.pageX + 10) + "px")
                          .style("top", (event.pageY - 10) + "px");
                })
                .on("mousemove", (event, d) => {
                    tooltip.style("left", (event.pageX + 10) + "px")
                          .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", () => {
                    tooltip.style("display", "none");
                });

            console.log("Map Loaded with", houseData.length, "homes");
            console.log(houseData["Property Type"]);
            console.log(houseData[0]);


        };

        const loadHomes = async () => {
            const houseData = await d3.csv("zillow_pittsburgh.csv");

            const homeList = d3.select("#list-container");

            homeList.selectAll(".list-item")
                .data(houseData)
                .join("div")
                .attr("class", "list-item")
                .html(d => {
                    const icon = homeTypeIcons[d["Property Type"]] || "default.svg";
                    return `<img src="${icon}" alt="${d.Type}">`;
                });
        };

        loadData();

        // Function to update the list dynamically
        const updateList = (data) => {
          const homeList = d3.select("#list-container");

          homeList.selectAll(".list-item")
              .data(data)
              .join("div")
              .attr("class", "list-item")
              .html(d => {
                  const icon = homeTypeIcons[d["Property Type"]] || "default.svg";
                  return `<img src="${icon}" alt="${d.Type}">`;
                });
        };

        // Function to update map
        const updateMap = async (data) => {
            var neigh = pittsburghGeoJSON.features;

            var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], { type: "FeatureCollection", features: neigh });
            var path = d3.geoPath().projection(projection);
          
            map.selectAll("path.neighborhood").data(neigh)
                .join("path")
                .attr("class", "neighborhood")
                .attr("d", path);

            const tooltip = d3.select("#tooltip");

            map.selectAll("circle").data(data)
                .join("circle")
                .attr("class", "circle")
                .attr("cx", d => projection([+d.Longitude, +d.Latitude])[0])
                .attr("cy", d => projection([+d.Longitude, +d.Latitude])[1])
                .attr("r", 3)
                .attr("fill", d => homeTypeColors(d["Property Type"]) || "#ccc") 
                .attr("opacity", 0.7)
                .attr("stroke", "black")
                .attr("stroke-width", 0.5)
                .on("mouseover", (event, d) => {
                    tooltip.style("display", "block")
                          .html(`Neighborhood: <strong>${d.Neighborhood}</strong>`)
                          .style("left", (event.pageX + 10) + "px")
                          .style("top", (event.pageY - 10) + "px");
                })
                .on("mousemove", (event, d) => {
                    tooltip.style("left", (event.pageX + 10) + "px")
                          .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", () => {
                    tooltip.style("display", "none");
                }),
                update => update,
                exit => exit.remove() ;
      };

        document.getElementById("bedFilter").addEventListener("change", applyFilters);
        document.getElementById("bathFilter").addEventListener("change", applyFilters);
        document.getElementById("homeTypeFilter").addEventListener("change", applyFilters);



    </script>
</body>
</html>

